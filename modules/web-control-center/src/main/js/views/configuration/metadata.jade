//-
    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

         http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

extends sidebar

append scripts
    script(src='/metadata-controller.js')

include ../includes/controls

block content
    .docs-header
        h1 Create and Configure Cache Type Metadata
        hr
    .docs-body(ng-controller='metadataController')
        +block-callout('{{screenTip.workflowTitle}}', 'joinTip(screenTip.workflowContent)', '{{screenTip.whatsNextTitle}}', 'joinTip(screenTip.whatsNextContent)')
        div(ng-hide='metadatas.length == 0')
            .padding-dflt
                lable.labelHeader Types metadata:
                table.links(st-table='metadatas')
                    tbody
                        tr(ng-repeat='row in metadatas track by row._id')
                            td.col-sm-6(ng-class='{active: row._id == selectedItem._id}')
                                a(ng-click='selectItem(row)') {{$index + 1}}) {{row.name}}
        .padding-top-dflt
            button.btn.btn-primary(ng-click='panels.activePanel = [0]; createItem()') &nbspAdd metadata
            label(style='margin-left: 6px; margin-right: 10px') For:
            button.btn.btn-default(ng-model='template' data-template='/select' data-placeholder='Choose metadata type' bs-options='item.value as item.label for item in templates' bs-select)
            i.tiplabel.fa.fa-question-circle(bs-tooltip data-title='{{joinTip(templateTip)}}' type='button')
        hr
        .panel-group(bs-collapse ng-model='panels.activePanel' data-allow-multiple="false")
            .panel.panel-default(ng-show='selectedItem || backupItem')
                .panel-heading
                    h3
                        a(bs-collapse-toggle) Manual
                .panel-collapse(role="tabpanel" bs-collapse-target)
                    .panel-body
                        form.form-horizontal(name='manualForm' ng-if='backupItem' novalidate)
                            .settings-row(ng-repeat='field in metadataManual')
                                +form-row
                            button.btn.btn-primary(ng-disabled='manualForm.$invalid' ng-click='saveItem()') Save
                            button.btn.btn-primary(ng-show='backupItem._id' ng-disabled='inputForm.$invalid' ng-click='saveItemAs()') Copy
                            button.btn.btn-primary.btn-second(ng-show='backupItem._id' ng-click='removeItem()') Remove
            .panel.panel-default
                .panel-heading
                    h3
                        a(bs-collapse-toggle) Load from database
                .panel-collapse(bs-collapse-target)
                    .panel-body
                        form.form-horizontal(name='dbForm' novalidate)
                            .settings-row(ng-repeat='field in metadataDb')
                                +form-row
                        div(ng-hide='data.tables.length == 0')
                            table.table-bordered.table-condensed.links-edit-small-padding.col-sm-12(st-table='data.tables')
                                thead
                                    tr
                                        th.col-sm-3 Schema/Table
                                        th Key class
                                        th Value class
                                tbody
                                    tr(ng-repeat='row in data.tables')
                                        td(colspan='{{row.tableName ? 1 : 3}}')
                                            div.checkbox(ng-if='!row.tableName')
                                                label(ng-click='selectSchema($index)')
                                                    input(type='checkbox' ng-checked='row.use')
                                                    | {{row.schemaName}}
                                            div.checkbox(ng-if='row.tableName')
                                                label(style='padding-left: 30px' ng-click='selectTable($index)')
                                                    input(type='checkbox' ng-checked = 'row.use')
                                                    | {{row.tableName}}
                                        td(ng-if='row.tableName')
                                            a(ng-show='data.curTableIdx != $index' ng-click='selectTable($index)') {{row.keyClass}}
                                            input.form-control(type='text' ng-show='data.curTableIdx == $index' ng-model='data.curKeyClass' placeholder='Key class full name')
                                        td(ng-if='row.tableName')
                                            a(ng-show='data.curTableIdx != $index' ng-click='selectTable($index)') {{row.valueClass}}
                                            input.form-control(type='text' ng-show='data.curTableIdx == $index' ng-model='data.curValueClass' placeholder='Value class full name')
                        //div(ng-hide='data.curTableIdx < 0')
                        //    table.table-bordered.table-condensed.links-edit-small-padding.col-sm-12(st-table='data.tables[data.curTableIdx].fields')
                        //        thead
                        //            tr
                        //                th(style='width:45px') Use
                        //                th(style='width:45px') Key
                        //                th(style='width:45px') Ak
                        //                th DB Name
                        //                th DB Type
                        //                th Java Name
                        //                th Java Type
                        //        tbody
                        //            tr(ng-repeat='row in data.tables[data.curTableIdx].fields')
                        //                td
                        //                    +dbcheck('row.use')
                        //                td
                        //                    +dbcheck('row.key')
                        //                td
                        //                    +dbcheck('row.ak')
                        //                td
                        //                    label {{row.dbName}}
                        //                td
                        //                    label {{row.dbType}}
                        //                td
                        //                    a(ng-show='data.curFieldIdx != $index' ng-click='selectField($index)') {{row.javaName}}
                        //                    input.form-control(type='text' ng-show='data.curFieldIdx == $index' ng-model='data.curJavaName' placeholder='Field Java name')
                        //                td
                        //                    a(ng-show='data.curFieldIdx != $index' ng-click='selectField($index)') {{row.javaType}}
                        //                    input.form-control(type='text' ng-show='data.curFieldIdx == $index' ng-model='data.curJavaType' placeholder='Field Java type')
                        button.btn.btn-primary(ng-disabled='dbForm.$invalid' ng-click='saveItem()') Save
                        button.btn.btn-primary.btn-second(ng-show='backupItem._id' ng-click='removeItem()') Remove
                        button.btn.btn-primary.btn-second(ng-click='reloadMetadata()') Reload